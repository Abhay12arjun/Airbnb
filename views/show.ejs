<% layout("boilerplate") %> 
<!-- for reviews deletions -->
 <% if (revdel && revdel.length > 0) { %>
  <div class="alert alert-success alert-dismissible fade show" role="alert">
    <%= revdel %>
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
  </div>
<% } %>

<% if (revdel && revdel.length < 0) { %>
  <div class="alert alert-danger alert-dismissible fade show" role="alert">
    <%= error %>
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
  </div>
<% } %>

<!-- for the reviews -->
<% if (review && review.length > 0) { %>
  <div class="alert alert-success alert-dismissible fade show" role="alert">
    <%= review %>
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
  </div>
<% } %>

<% if (error && error.length > 0) { %>
  <div class="alert alert-danger alert-dismissible fade show" role="alert">
    <%= error %>
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
  </div>
<% } %>



 <!-- // edit formate -->
<% if (edit && edit.length > 0) { %>
  <div class="alert alert-success alert-dismissible fade show" role="alert">
    <%= edit %>
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
  </div>
<% } %>

<% if (edit && edit.length < 0) { %>
  <div class="alert alert-danger alert-dismissible fade show" role="alert">
    <%= edit %>
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
  </div>
<% } %>
<body class="bg-light">

  <div class="container py-5">

    <div class="row justify-content-center">
      <div class="col-lg-8 col-md-10">
        <div class="card shadow-lg rounded-4 p-3">

          <!-- Image -->
          <img 
            src="<%= listing.image %>" 
            class="card-img-top rounded-3" 
            alt="Listing Image" 
            style="height: 28rem; object-fit: cover;"
          >

          <!-- Card Body -->
          <div class="card-body mt-4">
            <h2 class="card-title text-primary fw-bold"><%= listing.title %></h2>
            <p class="card-text fs-5 text-secondary"><%= listing.description %></p>
            <p class="card-text fs-4 fw-bold text-success">
              &#8377;<%= listing.price.toLocaleString("en-In") %>
            </p>
            <p class="card-text fs-5">
              <i class="bi bi-geo-alt-fill text-danger"></i>
              <%= listing.location %>, <%= listing.country %>
            </p>
          </div>

          <!-- Buttons -->
           <% if (currUser && listing.owner && currUser._id.toString() === listing.owner._id.toString()) { %>


           
          <div class="d-flex justify-content-between px-3 pb-3">
            <form action="/listings/<%= listing._id %>/edit">
              <button type="submit" class="btn btn-lg btn-primary px-4">Edit</button>
            </form>
            <form action="/listings/<%= listing._id %>?_method=DELETE" method="POST">
              <button type="submit" class="btn btn-lg btn-danger px-4">Delete</button>
            </form>
          </div>
          <%}%>
         

        </div>
        
        
        <hr>
         <h1>Mention Your Feedback</h1>
     <form method="post" action="/listings/<%= listing._id %>/reviews" 
      class="p-3 border rounded shadow-sm bg-light needs-validation" novalidate>
  
  <!-- Rating -->
  <div class="mb-3">
    <label for="rating" class="form-label fw-bold">Rating</label>
    <input 
      id="rating" 
      name="review[rating]" 
      type="range" 
      class="form-range" 
      min="1" 
      max="10" 
      required
    >
    <div class="d-flex justify-content-between">
      <small class="text-muted">1</small>
      <small class="fw-bold text-primary" id="ratingValue">5</small>
      <small class="text-muted">10</small>
    </div>
    <div class="invalid-feedback">Please provide a rating.</div>
  </div>

  <!-- Comment -->
  <div class="mb-3">
    <label for="comment" class="form-label fw-bold">Comment</label>
    <textarea 
      name="review[comment]" 
      class="form-control" 
      id="comment" 
      cols="30" 
      rows="5"
      placeholder="Write your review here..."
      required
    ></textarea>
    <div class="invalid-feedback">Please enter a comment.</div>
  </div>

  <!-- Submit -->
  <button type="submit" class="btn btn-dark w-100">Submit</button>
</form>
<hr>
<h3 class="mb-3">All Reviews</h3>

<div class="row row-cols-1 row-cols-md-2 g-3">
  <% for (review of listing.reviews) { %>
    <div class="col">
      <div class="card shadow-sm border-0 rounded-3">
        <div class="card-body">
          <p class="card-title mb-2">John Doe</p>
          <p class="card-text mb-2"><%= review.comment %></p>
          <p class="card-subtitle text-muted">
            Rating: <span class="fw-bold text-primary"><%= review.rating %></span>/10
          </p>

          <form action="/listings/<%=listing._id%>/reviews/<%=review._id%>?_method=DELETE" method="post" class="mt-3">
             <button  class="btn btn-danger">Delete</button>
          </form>

         
        </div>
      </div>
    </div>
  <% } %>
</div>



      </div>
    </div>
  </div>

  <!-- Bootstrap Icons -->
   <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
</body>
