<% layout("boilerplate") %> 
<!-- for reviews deletions -->
 <% if (revdel && revdel.length > 0) { %>
  <div class="alert alert-success alert-dismissible fade show" role="alert">
    <%= revdel %>
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
  </div>
<% } %>

<% if (revdel && revdel.length < 0) { %>
  <div class="alert alert-danger alert-dismissible fade show" role="alert">
    <%= error %>
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
  </div>
<% } %>
<style>
  .star { font-size: 1.5rem; color: #ccc; }
.star.filled { color: gold; }

</style>

<!-- for the reviews -->
<% if (review && review.length > 0) { %>
  <div class="alert alert-success alert-dismissible fade show" role="alert">
    <%= review %>
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
  </div>
<% } %>

<% if (error && error.length > 0) { %>
  <div class="alert alert-danger alert-dismissible fade show" role="alert">
    <%= error %>
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
  </div>
<% } %>



 <!-- // edit formate -->
<% if (edit && edit.length > 0) { %>
  <div class="alert alert-success alert-dismissible fade show" role="alert">
    <%= edit %>
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
  </div>
<% } %>

<% if (edit && edit.length < 0) { %>
  <div class="alert alert-danger alert-dismissible fade show" role="alert">
    <%= edit %>
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
  </div>
<% } %>
<body class="bg-light">

  <div class="container py-5">

    <div class="row justify-content-center">
      <div class="col-lg-8 col-md-10">
        <div class="card shadow-lg rounded-4 p-3">
          
         
          <div class="row">
  <% listing.images.forEach(img => { %>
    
    <div class="">
      <img src="<%= img %>" alt="Listing Image" class="img-fluid rounded-3 shadow-sm">
    </div>
  <% }) %>
</div>


          <!-- Image -->
          <!-- <img 
            src=" listing.image " 
            class="card-img-top rounded-3" 
            alt="Listing Image" 
            style="height: 28rem; object-fit: cover;"
          > -->
          
  
  
          







          <!-- Card Body -->
          <div class="card-body mt-4">
            <h2 class="card-title text-primary fw-bold"><%= listing.title %></h2>
            <p class="card-text fs-5 text-secondary"><%= listing.description %></p>
            <p class="card-text fs-4 fw-bold text-success">
              &#8377;<%= listing.price.toLocaleString("en-In") %>
            </p>
            <p class="card-text fs-5">
              <i class="bi bi-geo-alt-fill text-danger"></i>
              <%= listing.location %>, <%= listing.country %>
            </p>
          </div>

          <!-- Buttons -->
           <% if (currUser && listing.owner && currUser._id.toString() === listing.owner._id.toString()) {%> 


           
          <div class="d-flex justify-content-between px-3 pb-3">
            <form action="/listings/<%= listing._id %>/edit">
              <button type="submit" class="btn btn-lg btn-primary px-4">Edit</button>
            </form>
            <form action="/listings/<%= listing._id %>?_method=DELETE" method="POST">
              <button type="submit" class="btn btn-lg btn-danger px-4">Delete</button>
            </form>
          </div>
          
         <%}%>

        </div>
        
        
        <hr>
        <% if(currUser) {%>
         <h1>Mention Your Feedback</h1>
     <form method="post" action="/listings/<%= listing._id %>/reviews" 
      class="p-3 border rounded shadow-sm bg-light needs-validation" novalidate>
  
  <!-- Rating -->


  <!-- Ratings as the star -->
 
 <div class="mb-3">
  <label for="rating" class="form-label fw-bold">Rating</label>
  <div class="rating d-flex gap-1 form-control">
    <% for (let i = 5; i >= 1; i--) { %>
      <input type="radio" id="star<%= i %>" name="review[rating]" value="<%= i %>" required>
      <label for="star<%= i %>">★</label>
    <% } %>
  </div>
  <div class="invalid-feedback">Please provide a rating.</div>
</div>

<style>
.rating {
  display: flex;
  flex-direction: row-reverse;
  justify-content: flex-start;
}
.rating input {
  display: none; /* hide the radios */
}
.rating label {
  font-size: 2rem;
  color: #ccc;
  cursor: pointer;
  transition: color 0.2s;
}
.rating input:checked ~ label,
.rating label:hover,
.rating label:hover ~ label {
  color: gold;
}
</style>


<!-- Comment -->
<div class="mb-3">
  <label for="comment" class="form-label fw-bold">Comment</label>
  <textarea 
    name="review[comment]" 
    class="form-control" 
    id="comment" 
    cols="30" 
    rows="5"
    placeholder="Write your review here..."
    required
  ></textarea>
  <div class="invalid-feedback">Please enter a comment.</div>
</div>

<!-- Submit -->
<button type="submit" class="btn btn-dark w-100">Submit</button>
</form>
<%}%>
<style>
.rating {
  display: flex;
  flex-direction: row-reverse;
  justify-content: flex-start;
}
.rating input {
  display: none;
}
.rating label {
  font-size: 2rem;
  color: #ccc;
  cursor: pointer;
  transition: color 0.2s;
}
.rating input:checked ~ label,
.rating label:hover,
.rating label:hover ~ label {
  color: gold;
}
</style>


<hr>

<!-- //showing the star reviews -->
<h3 class="mb-3">All Reviews</h3>

<div class="row row-cols-1 row-cols-md-2 g-3">
  <% for (let review of listing.reviews) { %>
    <div class="col">
      <div class="card shadow-sm border-0 rounded-3">
        <div class="card-body">
          <!-- Author -->
          <p class="card-title mb-2">@<%= review.author.username %></p>

          <!-- Comment -->
          <p class="card-text mb-2"><%= review.comment %></p>

          <!-- ⭐ Star Rating -->
          <div class="stars mb-2">
            <% for (let i = 1; i <= 5; i++) { %>
  <span class="star <%= i <= review.rating ? 'filled' : '' %>">★</span>
<% } %>

         
         

          </div>
          <p class="card-subtitle text-muted">
            (<%= review.rating %> / 5)
          </p>

          <!-- Delete button (only for author) -->
          <% if (currUser && review.author && currUser._id.toString() === review.author._id.toString()) { %>
            <form action="/listings/<%= listing._id %>/reviews/<%= review._id %>?_method=DELETE" method="POST" class="mt-3">
              <button class="btn btn-danger">Delete</button>
            </form>
          <% } %>
        </div>
      </div>
    </div>
  <% } %>
</div>


</div>



      </div>
    </div>
  </div>

  <!-- Bootstrap Icons -->
   <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
</body>
